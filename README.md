# API для реферальной системы

### Описание
- Необходимо разработать простой RESTful API сервис для реферальной системы.

### Функциональные требования:
- Регистрация и аутентификация пользователя (JWT, Oauth 2.0);
- Аутентифицированный пользователь должен иметь возможность создать или удалить свой реферальный код. Одновременно может быть активен только 1 код. При создании кода обязательно должен быть задан его срок годности;
- Возможность получения реферального кода по email 	адресу реферера;
- Возможность регистрации по реферальному коду в 	качестве реферала;
- Получение 	информации о рефералах по id 	реферера;
- UI документация 	(Swagger/ReDoc).
### Опциональные задачи:
- Использование clearbit.com/platform/enrichment 	для получения дополнительной информации о пользователе при регистрации;
- Использование emailhunter.co для проверки указанного email 	адреса;
- Кеширование реферальных кодов с использованием in-memory БД;
- Readme.md 	файл с описанием проекта и инструкциями по запуску и тестированию
### Стек:
- Использование любого современного веб фреймворка;
- Использование СУБД и миграций (Sqlite, 	PostgreSQL, MySQL);
- Размещение проекта на GitHub.

### Требования к проекту:
- Чистота и читаемость кода;
- Все I/O bound операции должны быть асинхронными;
- Проект должен быть хорошо структурирован;
- Проект должен быть простым в деплое, обеспечивать обработку нестандартных ситуаций, быть устойчивой к неправильным действиям пользователя и т. д.

### Запуск проекта на локальном сервере
1. Клонировать репозиторий
- git clone https://github.com/topgun312/referal-api-test.git
2. Cоздать и активировать виртуальное окружение, установить зависимости:
- (venv) $ cd backend
- poetry install
3. Создать файл .env и записать следующие аргументы

- DB_NAME=postgres - название БД
- DB_HOST=localhost - название сервера
- DB_PORT=5432 - порт для подключения к БД
- DB_USER=postgres - логин для подключения к БД
- DB_PASS=postrges - пароль для подключения к БД

- MODE=DEV - режим разработки

- REDIS_HOST=redis - название сервиса redis
- REDIS_PORT=6379 - порт для подключения к redis

- SMTP_USER=user1example@gmail.com - email отправителя
- SMTP_PASSWORD=oisd vavf cbff pscx - пароль для отправки 
- SMTP_HOST=smtp.gmail.com - название сервера google почты
- SMTP_PORT=465 - порт для подключения к google почте

- EMAIL_HUNTER_API_KEY=my_api_key - API ключ для взаимодействия с emailhunter.co
- CLEARBIT_API_KEY=mykey - API ключ для взаимодействия с clearbit.com

4. Создаем миграции (в проекте уже будут созданы миграции с соответсвующими настройками для БД):
   -  alembic revision --autogenerate -m "Add table"

5. Применяем миграции:
   - alembic upgrade head

6. Запускаем приложение:
   - uvicorn main:app --reload


### Запуск проекта в docker-контейнере
1. Клонировать репозиторий
- git clone https://github.com/topgun312/referal-api-test.git

2. Создать файл .env-non-dev для продакшена и записать к аргументам из файла .env следующие аргументы
- POSTGRES_DB=postgres - название БД
- POSTGRES_USER=postgres - логин для подключения к БД
- POSTGRES_PASSWORD=postgres - пароль для подключения к БД

3. Собрать образ docker-контейнера
- docker-compose up --no-cache

4. Запустить docker-контейнер
- docker-compose up

### Основные используемые библиотеки:
- python = "^3.10"
- fastapi = {extras = ["all"], version = "^0.115.2"}
- sqlalchemy = "^2.0.36"
- alembic = "^1.13.3"
- asyncpg = "^0.29.0"
- fastapi-cache2 = {extras = ["redis"], version = "^0.2.2"}
- loguru = "^0.7.2"
- sqlalchemy-utils = "^0.41.2"
- pyjwt = "^2.9.0"
- bcrypt = "^4.2.0"
- gunicorn = "^23.0.0"
- cryptography = "^43.0.1"
- email-hunter-python = "^1.1.0"
- uvicorn = "^0.32.0"
- black = "^24.10.0"
- isort = "^5.13.2"

